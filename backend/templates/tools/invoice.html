{% extends "base.html" %}

{% block title %}Invoice Generator{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-file-invoice"></i> Invoice Generator</h2>
                </div>
                <div class="card-body">
                    <form id="invoiceForm" method="POST" action="/generate" enctype="multipart/form-data">
                        <input type="hidden" name="tool" value="invoice">
                        
                        <h4>Company Information</h4>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="companyName" class="form-label">Company Name *</label>
                                    <input type="text" class="form-control" id="companyName" 
                                           name="company_name" value="Your Company Name" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="companyEmail" class="form-label">Company Email *</label>
                                    <input type="email" class="form-control" id="companyEmail" 
                                           name="company_email" value="contact@yourcompany.com" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="companyAddress" class="form-label">Company Address *</label>
                            <textarea class="form-control" id="companyAddress" 
                                      name="company_address" rows="3" required>123 Business Street
Suite 100
City, State 12345</textarea>
                        </div>
                        
                        <h4>Client Information</h4>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="clientName" class="form-label">Client Name *</label>
                                    <input type="text" class="form-control" id="clientName" 
                                           name="client_name" value="Client Company Name" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="clientEmail" class="form-label">Client Email *</label>
                                    <input type="email" class="form-control" id="clientEmail" 
                                           name="client_email" value="client@example.com" required>
                                </div>
                            </div>
                        </div>
                        
                        <h4>Invoice Details</h4>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="invoiceNumber" class="form-label">Invoice Number *</label>
                                    <input type="text" class="form-control" id="invoiceNumber" 
                                           name="invoice_number" value="INV-2024-001" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="invoiceDate" class="form-label">Invoice Date *</label>
                                    <input type="date" class="form-control" id="invoiceDate" 
                                           name="invoice_date" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="dueDate" class="form-label">Due Date *</label>
                                    <input type="date" class="form-control" id="dueDate" 
                                           name="due_date" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="currency" class="form-label">Currency *</label>
                                    <select class="form-control" id="currency" name="currency" required>
                                        <option value="USD">USD - US Dollar</option>
                                        <option value="EUR">EUR - Euro</option>
                                        <option value="INR">INR - Indian Rupee</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="taxRate" class="form-label">Tax Rate (%)</label>
                                    <input type="number" class="form-control" id="taxRate" 
                                           name="tax_rate" value="10" step="0.01" min="0" max="100">
                                </div>
                            </div>
                        </div>
                        
                        <h4>Invoice Items</h4>
                        <div class="table-responsive">
                            <table class="table" id="itemsTable">
                                <thead>
                                    <tr>
                                        <th>Description</th>
                                        <th>Quantity</th>
                                        <th>Rate</th>
                                        <th>Amount</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <input type="text" class="form-control" 
                                                   name="item_description[]" value="Web Development Services" required>
                                        </td>
                                        <td>
                                            <input type="number" class="form-control" 
                                                   name="item_quantity[]" value="1" min="0" step="0.01" required>
                                        </td>
                                        <td>
                                            <input type="number" class="form-control" 
                                                   name="item_rate[]" value="1000" min="0" step="0.01" required>
                                        </td>
                                        <td>
                                            <input type="number" class="form-control" name="item_amount[]" 
                                                   value="1000" readonly>
                                        </td>
                                        <td>
                                            <button type="button" class="btn btn-sm btn-danger" onclick="removeItem(this)">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="form-group">
                            <button type="button" class="btn btn-outline-primary" onclick="addItem()">
                                <i class="fas fa-plus"></i> Add Item
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <label for="notes" class="form-label">Notes</label>
                            <textarea class="form-control" id="notes" 
                                      name="notes" rows="3">Thank you for your business!</textarea>
                        </div>
                        
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary btn-lg" data-action="generate">
                                <i class="fas fa-file-pdf"></i> Generate Invoice PDF
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h4><i class="fas fa-eye"></i> Preview</h4>
                </div>
                <div class="card-body">
                    <div id="invoicePreview">
                        <p class="text-muted">Preview will appear here</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="download-container mt-4"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date();
    const dueDate = new Date(today);
    dueDate.setDate(today.getDate() + 30);
    
    document.getElementById('invoiceDate').value = today.toISOString().split('T')[0];
    document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];
    
    calculateAmounts();
});

function addItem() {
    const tbody = document.querySelector('#itemsTable tbody');
    const newRow = document.createElement('tr');
    newRow.innerHTML = `
        <td>
            <input type="text" class="form-control" 
                   name="item_description[]" placeholder="Item description" required>
        </td>
        <td>
            <input type="number" class="form-control" 
                   name="item_quantity[]" value="1" min="0" step="0.01" required>
        </td>
        <td>
            <input type="number" class="form-control" 
                   name="item_rate[]" value="0" min="0" step="0.01" required>
        </td>
        <td>
            <input type="number" class="form-control" name="item_amount[]" 
                   value="0" readonly>
        </td>
        <td>
            <button type="button" class="btn btn-sm btn-danger" onclick="removeItem(this)">
                <i class="fas fa-trash"></i>
            </button>
        </td>
    `;
    
    tbody.appendChild(newRow);
    
    const inputs = newRow.querySelectorAll('input');
    inputs.forEach(input => {
        input.addEventListener('input', calculateAmounts);
    });
}

function removeItem(button) {
    const row = button.closest('tr');
    row.remove();
    calculateAmounts();
}

function calculateAmounts() {
    const rows = document.querySelectorAll('#itemsTable tbody tr');
    
    rows.forEach(row => {
        const quantity = parseFloat(row.querySelector('input[name="item_quantity[]"]').value) || 0;
        const rate = parseFloat(row.querySelector('input[name="item_rate[]"]').value) || 0;
        const amount = quantity * rate;
        
        row.querySelector('input[name="item_amount[]"]').value = amount.toFixed(2);
    });
}

// Add event listeners
document.addEventListener('DOMContentLoaded', function() {
    const inputs = document.querySelectorAll('#itemsTable input');
    inputs.forEach(input => {
        input.addEventListener('input', calculateAmounts);
    });
});
</script>
{% endblock %}